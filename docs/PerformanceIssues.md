# Performance Issues

# TODO

- [ ] Remove jQuery, if possible.
- [ ] Lazy load images (that are NOT in immediate view when viewing a page).
- [x] Preload CSS file.
- [ ] Move header to critical CSS file.
- [ ] Move frontPageBanner and frontPageKeyfigures to critical CSS file. (also other parts that are always at the top of the page)
- [ ] Move part CSS to its own file that is then included in part pageContributions if not done already. 
- [x] Move part JS that is not jsx to its own file that is then included in part pageContributions if not done already. 
- [ ] Don't import from @statisticsnorway/ssb-component-library, (bundle file). Import so that we support treeshaking. If lib does not support that, update lib so that it does.
- [ ] Disable hydration on react4xp parts where there is no hooks or event listeneres.



## Large bundle size
Large bundle sizes cause the end user to download more data than they need. It takes longer time to download, but most significantly the browser takes longer to parse the javascript. 

### vendor.js

The vendor.js file is generated by React4xp and it includes everything that ANY react files import from node_modules (unless configured). This causes the issue that even if the current page only uses react4xp to render a small part with no imports, the vendor file is still included. React4xp does not know at buildtime where parts are used and which are used together, thus it must bundle it all in a single file to avoid it being bundled more than once or outputting a thousand chunks. With webpack we can split packages out of the vendor file into their own chunk files with `splitChunks.cacheGroups`. This makes it so that a chunk file is only included where it is needed. Webpack will handle splitting and loading. See `webpack.config.react4xp.js`. Thus we split the big packages that are only used in certain places to their own chunks.

## Package size, treeshaking

Currently, the biggest offender is the Highcharts package. For example, on the frontpage, 178kb is transfered just to show a simple chart in the namesearch. We must investigate how to reduce it.